{% extends 'my_calendar/base.html' %}
{% load tz %}
{% block user_content %}
{% if access_denied %}
    <p>{{ access_denied }}</p>
{% else %}
    <h2>{{ event.title }}</h2>
    {% if guest_state_form %}
        <form method="POST" id="state_form">
            {% csrf_token %}
            {{ guest_state_form.as_p }}
            <button type="submit" id="save_state" value="1" name="save_state">Save state</button>
        </form>
    {% endif %}
    <p>{{ event.desc }}</p>
    {% with event.guest.event.calendar as calendar %}
    <p>Belongs to calendar: <a href="{% url 'my_calendar:calendar_view' cal_pk=calendar.pk %}">{{ calendar.name }}</a>
    {% endwith %}
    <p>All day: {{ event.all_day }}</p>
    {% if event.all_day == True %}
        <p>{{ event.start|date:"m/d/Y" }}</p>
        <p>{{ event.end|date:"m/d/Y" }}</p>
    {% else %}
        <p>Timezone: {{ event.get_timezone_display }}</p>
        {% timezone event.get_timezone_display %}
        <p>{{ event.start|date:"m/d/Y H:i" }}</p>
        <p>{{ event.end|date:"m/d/Y H:i" }}</p>
        {% endtimezone %}
    {% endif %}
    <ul>Guests:
    {% for guest in guests %}
        <li>{{ guest.user.user.username }}: {{ guest.get_state_display }}</li>
    {% endfor %}
    </ul>
    {% with event.guest.event.calendar as calendar %}
    {% if profile == calendar.owner or profile in calendar.can_modify.all %}
        <button onclick="FormDisplay('event_form', 'edit_event', 'Edit this event');return false;" id="edit_event">Edit this event</button>
        <form method="POST" id="event_form">
            {% csrf_token %}
            {{ event_form.as_p }}
            {{ state_form.as_p }}
            <button type="submit" id="save_event" name="save_event" value="1" onclick="EnableInputs();">Save event</button>
        </form>
        <button onclick="FormDisplay('guest_form', 'add_guest', 'Add guest');return false;" id="add_guest">Add guest</button>
        <form method="POST" id="guest_form">
            {% csrf_token %}
            {{ guest_form.as_p }}
            <button type="submit" id="save_guest" value="1" name="save_guest">Save guest</button>
        </form>
    {% endif %}
    {% endwith %}
    <script>
        var form = document.getElementById("event_form");
        form.style.display = 'none';
        form = document.getElementById("guest_form");
        form.style.display = 'none';
        function FormDisplay(form_id, button_id, text) {
            form = document.getElementById(form_id);
            button = document.getElementById(button_id);
            if (form.style.display !== 'none') {
                form.style.display = 'none';
                button.innerHTML = text
            }
            else {
                form.style.display = 'block';
                button.innerHTML = "Hide edition"
            }
        };
        var all_day = document.getElementById("id_all_day")
        var start_hour = document.getElementById("id_start_hour")
        var end_hour = document.getElementById("id_end_hour")
        var timezone = document.getElementById("id_timezone")
        var elements = [start_hour, end_hour, timezone]
        if (all_day.checked) {
            for (var i = 0; i < elements.length; i++) {
                    elements[i].disabled = true;
                }
        }
        all_day.onclick = function() {
            if (all_day.checked) {
                for (var i = 0; i < elements.length; i++) {
                    elements[i].disabled = true;
                }
            }
            else {
                for (var i = 0; i < elements.length; i++) {
                    elements[i].disabled = false;
                }
            }
        }
        function EnableInputs() {
            for (var i = 0; i < elements.length; i++) {
                elements[i].disabled = false;
            }
        }
            
    </script>
{% endif %}
{% endblock user_content %}