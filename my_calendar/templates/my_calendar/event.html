{% extends 'my_calendar/base.html' %}
{% load staticfiles %}
{% load tz %}
{% block content %}
{% if access_denied %}
    <div>{{ access_denied }}</div>
{% else %}
    <div class="row">
        <div class="col-lg-7">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">{{ event.title }}</h2>
                </div>
                <div class="panel-body">
                {% if user_is_guest %}
                    <form method="POST" id="attending_status_form">
                        {% csrf_token %}
                        {{ attending_status_form.as_p }}
                        <button type="submit" id="save_attending_status" value="1"name="save_attending_status">
                            Save your attending status
                        </button>
                    </form>
                {% endif %}
                    <p>From calendar: <a href="{% url 'my_calendar:calendar_view' cal_pk=event.calendar.pk %}">
                        {{ event.calendar.name }}</a>
                    </p>
                    {{ event.desc }}
                {% if event.all_day == True %}
                    <p>Start date: {{ event.start|date:"m/d/Y" }}</p>
                    <p>End date: {{ event.end|date:"m/d/Y" }}</p>
                {% else %}
                    <p>Timezone: {{ event.get_timezone_display }}</p>
                    {% timezone event.get_timezone_display %}
                        <p>Start time: {{ event.start|date:"m/d/Y H:i" }}</p>
                        <p>End time: {{ event.end|date:"m/d/Y H:i" }}</p>
                    {% endtimezone %}
                {% endif %}
                {% if profile in event.calendar.modifiers.all or user_is_guest %}
                    <button onclick="formDisplay('event_form', 'edit_event', 'Edit this event');return false;"
                    id="edit_event">Edit this event</button>
                    <form method="POST" id="event_form">
                        {% csrf_token %}
                        {% if user_is_guest %}
                            <p>{{ guest_message }}</p>
                        {% endif %}
                        {{ event_form.as_p }}
                        <button type="submit" id="save_event" name="save_event"
                            value="1" onclick="enableInputs();">
                            Save event
                        </button>
                    </form>
                {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-5">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">Guests</h2>
                </div>
                <div class="panel-body">
                {% if guests %}
                    <ul>
                    {% for guest in guests %}
                        <li>
                            <a href="{% url 'my_calendar:profile' username=guest.user.user.username %}" >{{ guest.user }}:</a>
                            {{ guest.get_attending_status_display }}
                        </li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p>This event has no guests</p>
                {% endif %}
                {% if profile in event.calendar.modifiers.all %}
                    <button onclick="formDisplay('guest_form', 'add_guest', 'Add guest');return false;"
                        id="add_guest">Add guest</button>
                    <form method="POST" id="guest_form">
                        {% csrf_token %}
                        {{ guest_form.as_p }}
                        <button type="submit" id="save_guest" value="1" name="save_guest">Save guest</button>
                    </form>
                {% endif %}
                </div><!-- panel-body -->
            </div><!-- panel -->
        </div><!-- col-lg-5 -->
    </div><!-- row -->
{% endif %}
{% endblock content %}
{% block scripts %}
<script>
    const forms = ['event_form', 'guest_form'];
</script>
<script src="{% static 'form_display.js' %}"></script>
<script src="{% static 'disable_event_inputs.js' %}"></script>
{% endblock %}
