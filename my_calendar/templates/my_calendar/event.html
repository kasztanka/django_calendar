{% extends 'my_calendar/base.html' %}
{% load staticfiles %}
{% load tz %}
{% block content %}
    {% if access_denied %}
        <div>{{ access_denied }}</div>
    {% else %}
        <h2>{{ event.title }}</h2>

        {% if user_is_guest %}
            <form method="POST" id="attending_status_form">
                {% csrf_token %}
                {{ attending_status_form.as_p }}
                <button type="submit" id="save_attending_status" value="1" name="save_attending_status">Save your attending status</button>
            </form>
        {% endif %}

        <div>{{ event.desc }}</div>
        {% with event.guest.event.calendar as calendar %}
            <div>Belongs to calendar: <a href="{% url 'my_calendar:calendar_view' cal_pk=calendar.pk %}">{{ calendar.name }}</a></div>
        {% endwith %}
        <div>All day: {{ event.all_day }}</div>

        {% if event.all_day == True %}
            <div>{{ event.start|date:"m/d/Y" }}</div>
            <div>{{ event.end|date:"m/d/Y" }}</div>
        {% else %}
            <div>Timezone: {{ event.get_timezone_display }}</div>
            {% timezone event.get_timezone_display %}
            <div>{{ event.start|date:"m/d/Y H:i" }}</div>
            <div>{{ event.end|date:"m/d/Y H:i" }}</div>
            {% endtimezone %}
        {% endif %}

        {% with event.guest.event.calendar as calendar %}
            {% if profile == calendar.owner or profile in calendar.modifiers.all or user_is_guest %}
                <button onclick="formDisplay('event_form', 'edit_event', 'Edit this event');return false;" id="edit_event">Edit this event</button>
                <form method="POST" id="event_form">
                    {% csrf_token %}
                    {% if user_is_guest %}
                        <div>{{ guest_message }}</div>
                    {% endif %}
                    {{ event_form.as_p }}
                    <button type="submit" id="save_event" name="save_event" value="1" onclick="enableInputs();">Save event</button>
                </form>
            {% endif %}

            <ul>Guests:
                {% for guest in guests %}
                    <li>{{ guest.user.user.username }}: {{ guest.get_attending_status_display }}</li>
                {% endfor %}
            </ul>

            {% if profile == calendar.owner or profile in calendar.modifiers.all %}
                <button onclick="formDisplay('guest_form', 'add_guest', 'Add guest');return false;" id="add_guest">Add guest</button>
                <form method="POST" id="guest_form">
                    {% csrf_token %}
                    {{ guest_form.as_p }}
                    <button type="submit" id="save_guest" value="1" name="save_guest">Save guest</button>
                </form>
            {% endif %}
        {% endwith %}

        <script>
            const forms = ['event_form', 'guest_form'];
        </script>
        <script src="{% static 'form_display.js' %}"></script>
        <script src="{% static 'disable_event_inputs.js' %}"></script>

    {% endif %}
{% endblock content %}
