{% extends 'my_calendar/base.html' %}
{% load staticfiles %}
{% block user_content %}

    {% if access_denied %}
        <div>{{ access_denied }}</div>
    {% else %}

        <div style="background-color:{{ calendar.color }};">Kolor kalendarza</div>
        <h2>{{ calendar.name }}</h2>
        <ul>Users who can read this calendar:
        {% for user in calendar.readers.all %}
            <li>{{ user }}</li>
        {% empty %}
            <div>No such users.</div>
        {% endfor %}
        </ul>
        <ul>Users who can modify events in this calendar:
        {% for user in calendar.modifiers.all %}
            <li>{{ user }}</li>
        {% empty %}
            <div>No such users.</div>
        {% endfor %}
        </ul>

        {% if profile == calendar.owner %}
            <button onclick="formDisplay('calendar_form', 'edit_calendar', 'Edit this calendar');return false;" id="edit_calendar">Edit this calendar</button>

            {% if form_errors %}
                <div>{{ form_errors }}</div>
            {% endif %}

            <form method="POST" id="calendar_form">
                {% csrf_token %}
                <div>
                    <label for="id_name">Name:</label>
                    <input id="id_name" maxlength="100" name="name" type="text" required />
                </div>
                <div>
                    <label for="id_color">Choose color:</label>
                    <input id="id_color" name="color" type="hidden"/>
                </div>
                {% for color in colors %}
                    <div style="background-color: #{{ color }}; height:20px; width:20px;" class="colors" name="#{{ color }}"></div>
                {% endfor %}
                <ul id="readers">Choose users who can read your calendar:
                    {% for user in calendar_form.readers %}
                        <li>{{ user }}</li>
                    {% endfor %}
                </ul>
                <ul id="modifiers">Choose users who can modify events in your calendar:
                    {% for user in calendar_form.modifiers %}
                        <li>{{ user }}</li>
                    {% endfor %}
                </ul>
                <button type="submit" id="save_calendar">Save calendar</button>
            </form>

            <a id="add_event" href="{% url 'my_calendar:new_event' cal_pk=calendar.pk %}">Add event</a>
        {% endif %}

        <div id="events">Events:
        {% for ev in events %}
            <a href="{% url 'my_calendar:event_view' event_pk=ev.pk %}">{{ ev.get_owner_settings.title }}</a>
        {% empty %}
            <span>You don't have any events in this calendar yet.</span>
        {% endfor %}
        </div>

        <script src="{% static 'calendar_form_colors.js' %}"></script>
        <script>
            const currentColor = document.getElementsByName("{{ calendar.color }}")[0];
            currentColor.className += " active";
            const input = document.getElementById("id_color");
            input.value = currentColor.getAttribute("name");
            const forms = ['calendar_form'];
        </script>
        <script src="{% static 'form_display.js' %}"></script>
    {% endif %}
{% endblock user_content %}
